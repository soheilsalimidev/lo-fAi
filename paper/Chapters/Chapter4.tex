% !TEX root = ../ui-thesis.tex
% !TeX program = xelatex

\chapter{ساخت خط لوله متن به لو-فای}
\section{معماری خط‌ لوله}

این خط لوله \LTRfootnote{pipeline} که در \xf{Fig:Pipe} نمایش داده شده است، شامل چند مرحله ای برای تولید موسیقی است که از مدل های مختلف و تکنیک ها برای تولید موسیقی با کیفیت بالا از متون بنام استفاده می کند. این روش را می توان به چهار مرحله اصلی تقسیم کرد:
\begin{itemize}
      \item  تولید موسیقی از متن
      \item  تبدیل نت به \lr{MIDI}
      \item پیش بینی نت ها
      \item پردازش پس از تولید موسیقی
\end{itemize}

در مرحله اول، از مدل  \lr{Musicgen} \cite{copet2023simple}، برای تولید موسیقی از متن استفاده می کنیم، که یک مدل از پیش آموزش‌ داده شده\LTRfootnote{pre-trained} را برای تولید موسیقی است.مدل، یک دنباله از مقادیر صوتی را بر اساس متن ورودی تولید می کند و صوت تولید شده را به عنوان فایل \lr{WAV} ذخیره می کند.

در مرحله دوم، از یک مدل دیگری با نام \lr{basic pitch} \cite{2022_BittnerBRME_LightweightNoteTranscription_ICASSP} برای پیش بینی نت های صوتی تولید شده استفاده می کنیم. مدل پیش بینی نت های صوتی، فایل صوتی را تحلیل می کند و نت ها را استخراج می کند که سپس برای تولید فایل \lr{MIDI} استفاده می شود.


در مرحله سوم، از  \xal{alg:token} استفاده می کنیم تا فایل \lr{MIDI} را به یک متن قابل فهم برای مدل خود تبدیل کنیم.

در مرحله چهارم، از \xal{algo:lofi_music} استفاده می کنیم تا آهنگ نهایی خود را بسازیم.
فایل صوتی تولید شده سپس با استفاده از \lr{IPython display module} پخش می شود و کاربر می تواند صوت تولید شده را بشنود.

برای دسترسی به کد ها و اجرا آنها به \xa{ap:codes} مراجعه کنید.

\subsection{کمبودهای استفاده مستقیم از مدل \lr{MusicGen} برای تولید موسیقی}

شاید این سوال ایجاد شود چرا باید مدل قوی مانند \lr{Musicgen} با این مدل ها \lr{pipe} شود تا بتواند این موسیقي ساده را تولید کند. مگر به تنها قادر به انجام اینکار نیست ؟ جواب این سوال این است که با اینکه
مدل \lr{Musicgen}، مانند بسیاری از مدل‌های تولید موسیقی دیگر، یک سیستم پیچیده
است که می‌تواند موسیقی با کیفیت بالا تولید کند، اما همچنین دارای
محدودیت‌هایی است. در اینجا چند دلیل وجود دارد که چرا استفاده مستقیم از آن
برای تولید موسیقی ممکن است ایده‌آل نباشد:


\begin{itemize}
      \item{کیفیت پایین و نویز}: همانطور که اشاره کردید، خروجی مدل
            \lr{Musicgen} می‌تواند نویزی و با کیفیت پایین باشد. این به این دلیل است که
            مدل بر روی مقدار زیادی داده آموزش دیده است که شامل موسیقی نویزی و با
            کیفیت پایین است. مدل این الگوها را یاد می‌گیرد و می‌تواند منجر به خروجی
            نویزی و با کیفیت پایین شود.
      \item{سختی در تغییر و ویرایش موسیقی تولید شده}: مدل \lr{Musicgen} موسیقی
            را به صورت فایل \lr{WAV} تولید می‌کند که یک فرمت باینری است. این باعث می‌شود
            تغییر و ویرایش موسیقی تولید شده دشوار باشد. سازندگان آهنگ ممکن است
            بخواهند یک نت، آکورد یا ملودی خاص را تغییر دهند، اما انجام این کار با
            یک فایل \lr{WAV} چالش‌برانگیز است.
      \item{انعطاف‌پذیری محدود در سبک و ژانر موسیقی}: مدل \lr{Musicgen} بر روی
            یک مجموعه داده خاص آموزش دیده است، به این معنی که درک محدودی از سبک‌ها
            و ژانرهای مختلف موسیقی دارد. سازندگان آهنگ ممکن است بخواهند موسیقی را
            در یک سبک یا ژانر خاص ایجاد کنند، اما مدل \lr{Musicgen} ممکن است نتواند
            موسیقی‌ای تولید کند که انتظارات آنها را برآورده کند.
\end{itemize}

به همین دلیل است که روش که ما توصیف کردیم، که از مدل \lr{Musicgen} برای
تولید موسیقی استفاده می‌کنیم و سپس از یک مدل جداگانه
برای پیش‌بینی گام صدای تولید شده و تبدیل آن
به \lr{MIDI} استفاده می‌کند و در نهایت ساخت موسیقي لو-فای با یک مدل دیگر می‌تواند ایده خوبی باشد. این رویکرد مزایای زیر را می‌دهد:

\begin{enumerate}
      \def\labelenumi{\arabic{enumi}.}
      \item
            \textbf{بهبود کیفیت و کاهش نویز در موسیقی تولید شده}
      \item
            \textbf{کنترل بیشتر بر فرآیند تولید موسیقی}
      \item
            \textbf{تغییر و ویرایش آسان‌تر موسیقی تولید شده}
\end{enumerate}

\section{ارزیابی خط لوله}
متن کاربران اغلب شامل نکات احساسی و انتظاراتی است که به سختی می‌توان آن‌ها را به صورت ریاضی اندازه‌گیری کرد. وقتی کاربران درخواست‌های خود را برای تولید موسیقی ارائه می‌دهند حال و هوا، جو و تأثیر احساسی مورد نظر خود را با متن می‌خواهند منتقل کنند. معیارهای ریاضی می‌توانند جنبه‌هایی مانند دقت نت‌ها یا زمان‌بندی را اندازه‌گیری کنند، اما در ثبت تأثیر احساسی و ارزش زیبایی‌شناختی موسیقی نمی‌توانند خیلی خوب عمل کنند. پس برای اینکه بتوانیم این \lr{pipeline} را ارزیابی کنیم یک  نظر سنجی انجام دادیم.

ما یک نظرسنجی با پنج کاربر، که به طوری حرفه ای در زمینه ساخت این نوع موسیقي هستند یا شنونده این نوع موسیقي هستند، برای ارزیابی اثربخشی
خط لوله تولید موسیقی خود انجام دادیم. این نظرسنجی شامل سوالاتی در مورد
کیفیت صدا، رضایت کاربر از خروجی موسیقی بود. متأسفانه، نتایج امیدوارکننده
نبود. در \xt{tb:result} خلاصه‌ای از بازخوردهای دریافت شده آمده است:

\begin{table}
      \centering
      \caption{نتایج نظرسنجی ارزیابی خط لوله}
      \label{tb:result}
      \resizebox{\columnwidth}{!}{%
            \begin{tabularx}{\linewidth}{
                  |>{\centering\arraybackslash}X|
                  >{\centering\arraybackslash}X<{\unskip~}|
                  }
                  \hline
                  سوال                   & پاسخ                                                                                                                            \\\hline
                  وضوح صدای تولید شده    & 20\% (یک نفر) (خیلی بلند بودن یک ساز و خیلی آرام بودن ساز دیگر)آن را ضعیف ارزیابی کردند و به ناهمخوانی درجه صدا ها اشاره کردند. \\  \hline
                  کیفیت موسیقی تولید شده & 40\% (دو نفر) احساس کردند که صدا عمق و احساس کافی ندارد و آن را تخت توصیف کردند.                                                \\ \hline
                  تطابق با ورودی‌ها       & همه نظر دهندگان به عدم تطابق بین انتظارات و خروجی اشاره کردند.                                                                  \\ \hline
            \end{tabularx}%
      }
\end{table}
همه نظر دهنده‌گان اشاره کردند که موسیقی تولید شده با ورودی‌های داده شده به خوبی
تطابق ندارد، که منجر به عدم تطابق بین انتظارات و خروجی شد.

ایده تبدیل متن به آهنگ ﻟﻮ-ﻓﺎﻱ \lr{(lo-fi)} ممکن است به دلیل وجود افکت‌های مختلف و نودهای متفاوت و همچنین عدم توانایی گفتار در تشبیه دقیق آن‌ها، به خوبی عمل نکند. موسیقی ﻟﻮ-ﻓﺎﻱ شامل عناصر مختلفی مانند افکت‌های صوتی، تغییرات در ریتم و تمپو، و استفاده از صداهای محیطی است که به سختی می‌توان آن‌ها را به صورت متنی توصیف کرد.

علاوه بر این، نودهای موسیقی ﻟﻮ-ﻓﺎﻱ معمولاً دارای حس و حال خاصی هستند که به سختی می‌توان آن‌ها را با کلمات بیان کرد. این نودها ممکن است شامل حس آرامش، نوستالژی، یا حتی غم باشند که انتقال این احساسات از طریق متن به موسیقی نیازمند درک عمیق و دقیق از موسیقی و احساسات انسانی است.

بنابراین، به دلیل پیچیدگی‌های احساسی و توصیف درست احساسات موجود در موسیقی ﻟﻮ-ﻓﺎﻱ، تبدیل متن به آهنگ ﻟﻮ-ﻓﺎﻱ ممکن است نتواند به طور کامل و دقیق این عناصر را بازتاب دهد. و مدل بتواند موسیقي تولید کند که مطابق ورودی باشد که کاربر وارد کرده است. همچنین این نتیجه در پروژه \lr{jacbz/Lofi} \cite{Zhang} نیز به دست آمده است.\footnote{نتیجه این کار در \url{https://github.com/jacbz/Lofi/tree/main/model\#lyrics2lofi} قابل مشاهده است.}
